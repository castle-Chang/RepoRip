# 12306铁路购票系统需求文档

## 项目概述

### 1.1 项目背景
基于中国铁路12306官方网站的功能特性和用户体验分析，设计并实现一个类12306的铁路购票系统。该系统需要支持用户注册、登录、查询车次、购票、退票、改签等核心功能，并具备高并发、低延迟的性能要求。

**参考网站**: https://kyfw.12306.cn/otn/resources/login.html

### 1.2 项目目标
- 实现完整的铁路购票业务流程
- 提供优秀的用户体验和界面设计
- 支持高并发访问（单机500QPS）
- 接口响应时间 ≤ 500ms
- 确保数据安全和系统稳定性

## 用户画像分析

### 2.1 目标用户群体
- **主要用户**: 24-40岁的中青年群体（占比约80%）
- **性别分布**: 男性65%，女性35%
- **地域分布**: 一线及新一线城市用户占比47.86%
- **消费能力**: 中高消费者占比63.91%
- **使用场景**: 商务出行、探亲访友、旅游出行

### 2.2 用户需求特征
- 购票流程简单快捷
- 信息查询准确及时
- 支付安全可靠
- 订单管理便捷
- 客服支持完善

## 功能需求分析

### 3.1 核心功能模块

#### 3.1.1 用户认证系统
**登录功能**
- 支持用户名/手机号 + 密码登录
- 图形验证码验证（防机器人）
- 记住登录状态（Token机制）
- 登录失败次数限制
- 找回密码功能

**注册功能**
- 实名制注册（姓名 + 身份证号）
- 手机号验证
- 邮箱验证（可选）
- 密码强度校验
- 用户协议确认
- 身份信息核验状态管理

#### 3.1.2 车次查询系统
**余票查询**
- 出发地/目的地选择
- 出发日期选择（支持60天预售期）
- 车次类型筛选（G/D/C/K/T等）
- 席别筛选（商务座/一等座/二等座/硬卧/软卧/硬座）
- 出发时间段筛选
- 实时余票显示
- 自动刷新功能

**车次详情**
- 列车时刻表
- 途经站点信息
- 票价信息
- 列车正晚点信息
- 列车基本信息（车型、运行时间等）

#### 3.1.3 购票系统
**选票购买**
- 乘车人管理（添加/编辑/删除）
- 多人购票支持
- 席位选择（部分车次）
- 学生票/儿童票优惠
- 候补购票功能
- 购票时间限制（30分钟支付）

**订单管理**
- 订单创建和锁定
- 订单状态跟踪
- 订单详情查看
- 历史订单查询
- 订单筛选和搜索

#### 3.1.4 支付系统
**支付方式**
- 银行卡支付
- 第三方支付（支付宝/微信）
- 铁路畅行会员积分支付
- 组合支付方式

**支付安全**
- 支付密码验证
- 短信验证码确认
- 支付超时处理
- 支付失败重试机制

#### 3.1.5 票务管理
**退票功能**
- 在线退票申请
- 退票手续费计算
- 批量退票支持
- 退款处理状态跟踪

**改签功能**
- 改签条件检查
- 可改签车次查询
- 改签费用计算
- 改签次数限制（每张票仅可改签一次）

### 3.2 辅助功能模块

#### 3.2.1 个人中心
- 个人信息管理
- 常用联系人管理
- 乘车人信息管理
- 账户安全设置
- 消息通知管理

#### 3.2.2 客服系统
- 在线客服咨询
- 常见问题FAQ
- 投诉建议反馈
- 服务评价系统

#### 3.2.3 信息服务
- 铁路资讯发布
- 列车正晚点查询
- 车站信息查询
- 出行指南

## UI/UX设计要求

### 4.1 视觉设计规范

#### 4.1.1 色彩方案
**主色调**
- 主色：铁路红 (#C41E3A) - 体现官方权威性
- 辅助色：深灰蓝 (#2C3E50) - 提供稳重感
- 背景色：浅灰 (#F8F9FA) - 确保内容可读性
- 成功色：绿色 (#28A745) - 操作成功提示
- 警告色：橙色 (#FFC107) - 注意事项提示
- 错误色：红色 (#DC3545) - 错误信息提示

#### 4.1.2 字体规范
- 主字体：微软雅黑/苹方/Helvetica
- 标题字号：18px-24px（加粗）
- 正文字号：14px-16px（常规）
- 辅助文字：12px-13px（细体）
- 行高：1.4-1.6倍字号

#### 4.1.3 布局规范
- 页面最大宽度：1200px
- 内容区域边距：20px
- 组件间距：16px/24px/32px
- 圆角半径：4px/8px
- 阴影效果：0 2px 8px rgba(0,0,0,0.1)

### 4.2 交互设计原则

#### 4.2.1 易用性原则
- 操作流程简化，减少用户点击次数
- 重要功能突出显示，次要功能适当隐藏
- 提供清晰的操作反馈和状态提示
- 支持键盘快捷操作

#### 4.2.2 一致性原则
- 统一的视觉风格和交互模式
- 一致的信息架构和导航结构
- 标准化的组件和控件使用
- 统一的错误处理和提示方式

#### 4.2.3 容错性原则
- 操作前确认机制
- 撤销和重做功能
- 智能表单验证
- 友好的错误提示信息

### 4.3 响应式设计
- 支持桌面端（1920px+）
- 支持平板端（768px-1024px）
- 支持移动端（320px-768px）
- 关键功能在所有设备上可用

## 技术架构要求

### 5.1 系统架构

#### 5.1.1 整体架构
采用微服务架构，前后端分离设计：
- **前端**: Vue.js 3.x + Element Plus UI框架
- **后端**: Spring Boot + Spring Cloud微服务架构
- **数据库**: MySQL 8.0（主数据） + Redis（缓存）
- **消息队列**: RabbitMQ（异步处理）
- **搜索引擎**: Elasticsearch（车次搜索）

#### 5.1.2 微服务划分
1. **用户认证服务** (user-auth-service)
   - 用户注册、登录、权限管理
   - JWT Token生成和验证
   - 身份信息核验

2. **车次信息服务** (train-info-service)
   - 车次基础信息管理
   - 余票查询和更新
   - 列车时刻表管理

3. **订单服务** (order-service)
   - 订单创建和管理
   - 购票业务逻辑
   - 退票改签处理

4. **支付服务** (payment-service)
   - 支付接口集成
   - 支付状态管理
   - 退款处理

5. **通知服务** (notification-service)
   - 短信通知
   - 邮件通知
   - 站内消息

### 5.2 数据库设计

#### 5.2.1 核心数据表
- **用户表** (users): 用户基本信息
- **乘车人表** (passengers): 乘车人信息
- **车次表** (trains): 列车基本信息
- **车站表** (stations): 车站信息
- **座位表** (seats): 座位信息
- **订单表** (orders): 订单信息
- **票务表** (tickets): 车票信息

#### 5.2.2 数据库优化
- 读写分离配置
- 分库分表策略（按日期分表）
- 索引优化（复合索引、覆盖索引）
- 连接池配置优化

### 5.3 缓存策略

#### 5.3.1 Redis缓存应用
- **热点数据缓存**: 车次信息、余票数据
- **用户会话缓存**: 登录状态、购物车
- **分布式锁**: 防止超卖、重复下单
- **限流控制**: API访问频率限制

#### 5.3.2 缓存更新策略
- 缓存穿透防护
- 缓存雪崩预防
- 缓存一致性保证
- 热点数据预加载

### 5.4 性能要求

#### 5.4.1 响应时间要求
- 页面加载时间 ≤ 2秒
- API接口响应时间 ≤ 500ms
- 数据库查询时间 ≤ 100ms
- 缓存命中率 ≥ 95%

#### 5.4.2 并发性能要求
- 单机支持500QPS
- 系统整体支持10000+并发用户
- 数据库连接池：最大200连接
- 支持水平扩展

### 5.5 安全要求

#### 5.5.1 数据安全
- 用户密码加密存储（BCrypt）
- 敏感信息加密传输（HTTPS）
- 身份证号等敏感数据脱敏显示
- SQL注入防护

#### 5.5.2 接口安全
- JWT Token认证
- API访问频率限制
- 图形验证码防机器人
- CSRF攻击防护

## API接口设计

### 6.1 用户认证接口

#### 6.1.1 用户注册
```
POST /api/auth/register
Content-Type: application/json

Request:
{
    "username": "用户名",
    "password": "密码",
    "phone": "手机号",
    "email": "邮箱",
    "realName": "真实姓名",
    "idCard": "身份证号"
}

Response:
{
    "code": 200,
    "message": "注册成功",
    "data": {
        "userId": "用户ID",
        "username": "用户名"
    }
}
```

#### 6.1.2 用户登录
```
POST /api/auth/login
Content-Type: application/json

Request:
{
    "username": "用户名/手机号",
    "password": "密码",
    "captcha": "验证码"
}

Response:
{
    "code": 200,
    "message": "登录成功",
    "data": {
        "token": "JWT Token",
        "userInfo": {
            "userId": "用户ID",
            "username": "用户名",
            "phone": "手机号"
        }
    }
}
```

### 6.2 车次查询接口

#### 6.2.1 余票查询
```
GET /api/trains/search
Parameters:
- fromStation: 出发站
- toStation: 到达站
- departDate: 出发日期
- trainType: 车次类型（可选）

Response:
{
    "code": 200,
    "message": "查询成功",
    "data": {
        "trains": [
            {
                "trainNo": "G1234",
                "fromStation": "北京南",
                "toStation": "上海虹桥",
                "departTime": "08:00",
                "arriveTime": "12:30",
                "duration": "4小时30分",
                "seats": {
                    "businessSeat": 10,
                    "firstClass": 50,
                    "secondClass": 200,
                    "noSeat": 100
                },
                "prices": {
                    "businessSeat": 1748,
                    "firstClass": 933,
                    "secondClass": 553
                }
            }
        ]
    }
}
```

### 6.3 订单管理接口

#### 6.3.1 创建订单
```
POST /api/orders/create
Content-Type: application/json
Authorization: Bearer {token}

Request:
{
    "trainNo": "G1234",
    "departDate": "2024-01-15",
    "fromStation": "北京南",
    "toStation": "上海虹桥",
    "passengers": [
        {
            "name": "张三",
            "idCard": "110101199001011234",
            "phone": "13800138000",
            "seatType": "secondClass",
            "ticketType": "adult"
        }
    ]
}

Response:
{
    "code": 200,
    "message": "订单创建成功",
    "data": {
        "orderId": "订单号",
        "totalAmount": 553,
        "paymentDeadline": "2024-01-15T10:30:00"
    }
}
```

## 部署和运维要求

### 7.1 部署环境
- **开发环境**: Docker容器化部署
- **测试环境**: Kubernetes集群
- **生产环境**: 云服务器集群（阿里云/腾讯云）
- **CDN加速**: 静态资源分发
- **负载均衡**: Nginx反向代理

### 7.2 监控和日志
- **应用监控**: Prometheus + Grafana
- **日志收集**: ELK Stack (Elasticsearch + Logstash + Kibana)
- **链路追踪**: Zipkin/Jaeger
- **告警机制**: 钉钉/邮件通知

### 7.3 备份和恢复
- **数据库备份**: 每日全量备份 + 实时增量备份
- **文件备份**: 重要文件异地备份
- **灾难恢复**: RTO ≤ 1小时，RPO ≤ 15分钟

## 项目实施计划

### 8.1 开发阶段划分

#### 第一阶段（4周）：基础框架搭建
- 项目架构设计和技术选型
- 开发环境搭建
- 基础框架代码实现
- 数据库设计和创建

#### 第二阶段（6周）：核心功能开发
- 用户认证系统
- 车次查询系统
- 基础UI界面开发
- 接口联调测试

#### 第三阶段（4周）：购票流程开发
- 订单管理系统
- 支付系统集成
- 退票改签功能
- 完整流程测试

#### 第四阶段（3周）：优化和测试
- 性能优化
- 安全加固
- 压力测试
- 用户体验优化

#### 第五阶段（2周）：部署上线
- 生产环境部署
- 数据迁移
- 监控配置
- 上线验收

### 8.2 质量保证
- **代码审查**: 所有代码必须经过同行评审
- **单元测试**: 代码覆盖率 ≥ 80%
- **集成测试**: 关键业务流程全覆盖
- **性能测试**: 满足并发和响应时间要求
- **安全测试**: 通过安全漏洞扫描

## 风险评估和应对策略

### 9.1 技术风险
- **高并发处理**: 采用分布式架构和缓存策略
- **数据一致性**: 使用分布式事务和补偿机制
- **系统稳定性**: 完善的监控和自动恢复机制

### 9.2 业务风险
- **需求变更**: 采用敏捷开发，快速响应变更
- **用户体验**: 持续收集用户反馈，迭代优化
- **数据安全**: 严格的权限控制和数据加密

### 9.3 运维风险
- **服务器故障**: 多机房部署，自动故障转移
- **网络攻击**: WAF防护，DDoS防护
- **数据丢失**: 多重备份策略，定期恢复演练

## 总结

本需求文档基于对12306官方网站的深入分析，结合现代Web开发技术和用户体验设计理念，提出了一个完整的铁路购票系统解决方案。该方案不仅涵盖了核心的业务功能，还充分考虑了系统的可扩展性、安全性和用户体验，为项目的成功实施提供了全面的指导。

在实际开发过程中，应根据具体的业务需求和技术条件，对本文档中的方案进行适当的调整和优化，确保最终交付的系统能够满足用户需求并具备良好的商业价值。